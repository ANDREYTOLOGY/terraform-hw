# Домашнее задание к занятию "`Управляющие конструкции в коде Terraform`" - `Чернышов Андрей`

### Задание 1

 скриншот входящих правил «Группы безопасности»  
![terraform 1](https://github.com/ANDREYTOLOGY/terraform-hw/blob/main/img/terraform3-1.png)  

### Задание 2
В рамках задания были созданы дополнительные виртуальные машины с использованием мета-аргументов ```count``` и ```for_each```.   
В файле ```for_each-vm.tf``` реализовано создание двух виртуальных машин для баз данных с использованием мета-аргумента ```for_each```.  
В файле ```count-vm.tf``` реализовано создание двух одинаковых веб-серверов. Использован мета-аргумент count, при этом имена формируются как ```web-${count.index + 1}```, что исключает создание web-0.  
Все созданные виртуальные машины назначены в ранее созданную группу безопасности из задания 1 с использованием параметра ```security_group_ids```

### Задание 3
Создана одиночная виртуальная машина storage без использования ```count``` и ```for_each```.
Дополнительные диски подключены к ВМ через блок ```dynamic secondary_disk``` с использованием ```for_each```.

### Задание 4

В файле ansible.tf реализована генерация динамического Ansible inventory с использованием функции templatefile и шаблона inventory.tftpl. В инвентарь передаются группы виртуальных машин, созданные в заданиях 2 и 3:  
```
webservers (2 ВМ)  
databases (2 ВМ)  
storage (1 ВМ)
```

В каждой записи хоста указываются внешний IP (ansible_host) и полное доменное имя (fqdn). После выполнения terraform apply был автоматически создан файл inventory.ini.
![terraform 1](https://github.com/ANDREYTOLOGY/terraform-hw/blob/main/img/terraform3-2.png)  
